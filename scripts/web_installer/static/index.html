<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXFIN OPS Setup</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="background-globes">
        <div class="globe g1"></div>
        <div class="globe g2"></div>
    </div>

    <div class="installer-container" id="app">

        <!-- Header -->
        <header>
            <div class="logo">EXFIN <span>API KURULUM SÄ°STEMÄ°</span></div>
            <div class="step-indicator">
                <div class="step active" id="s1">1</div>
                <div class="line"></div>
                <div class="step" id="s2">2</div>
                <div class="line"></div>
                <div class="step" id="s3">3</div>
                <div class="line"></div>
                <div class="step" id="s4">4</div>
                <div class="line"></div>
                <div class="step" id="s5">5</div>
            </div>
        </header>

        <!-- Step 1: App Selection -->
        <div class="card active" id="card-1">
            <h1>Uygulama SeÃ§imi</h1>
            <p class="intro-text">Kurmak istediÄŸiniz EXFIN Ã§Ã¶zÃ¼mÃ¼nÃ¼ seÃ§in. Her Ã§Ã¶zÃ¼m kendi veritabanÄ± yapÄ±sÄ± ve API
                yapÄ±landÄ±rmasÄ± ile gelir.</p>

            <div class="app-selector">
                <div class="app-card" onclick="selectApp('OPS', this)">
                    <div class="app-icon">âš™ï¸</div>
                    <div class="app-info">
                        <h3>EXFIN OPS</h3>
                        <p>Genel Operasyon YÃ¶netimi</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('RETAIL', this)">
                    <div class="app-icon">ğŸ›’</div>
                    <div class="app-info">
                        <h3>EXFIN RETAIL</h3>
                        <p>Perakende & MaÄŸazacÄ±lÄ±k</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('HRM', this)">
                    <div class="app-icon">ğŸ‘¥</div>
                    <div class="app-info">
                        <h3>EXFIN HRM - PDKS</h3>
                        <p>Ä°nsan KaynaklarÄ± & Personel</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('REST', this)">
                    <div class="app-icon">ğŸŒ</div>
                    <div class="app-info">
                        <h3>EXFIN REST</h3>
                        <p>Modern Restful API Servisi</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('BEATPY', this)">
                    <div class="app-icon">ğŸ</div>
                    <div class="app-info">
                        <h3>EXFIN BEATPY</h3>
                        <p>Python Destekli Analiz & BI</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('EXCHANGE', this)">
                    <div class="app-icon">ğŸ’±</div>
                    <div class="app-info">
                        <h3>EXFIN EXCHANGE</h3>
                        <p>DÃ¶viz BÃ¼rolarÄ± (TR & IQ Market)</p>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-primary" id="btn-next-1" disabled onclick="goToStep(2)">UygulamayÄ± SeÃ§ ve Devam
                    Et</button>
            </div>
        </div>

        <!-- Step 2: Welcome & Checks -->
        <div class="card" id="card-2">
            <h1>Sistem KontrolÃ¼</h1>
            <p class="intro-text">EXFIN Kurumsal Operasyon YÃ¶netim Sistemi kurulumuna hoÅŸ geldiniz. Bu sihirbaz,
                iÅŸletmenizin tÃ¼m dijital sÃ¼reÃ§lerini tek bir platformda toplamanÄ±za yardÄ±mcÄ± olur.</p>

            <div class="module-cards">
                <div class="mod-card">
                    <div class="mod-icon">ğŸ˜</div>
                    <h4>Logo Entegrasyonu</h4>
                    <p>Tiger/Go3 ERP verilerinizi anlÄ±k olarak EXFIN'e aktarÄ±r, Ã§ift yÃ¶nlÃ¼ konuÅŸur.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">ğŸ›’</div>
                    <h4>Retail & MaÄŸazacÄ±lÄ±k</h4>
                    <p>MaÄŸaza satÄ±ÅŸlarÄ±nÄ±, ambar durumlarÄ±nÄ± ve perakende operasyonlarÄ±nÄ±zÄ± yÃ¶netir.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">â±ï¸</div>
                    <h4>PDKS YÃ¶netimi</h4>
                    <p>Personel giriÅŸ-Ã§Ä±kÄ±ÅŸ takibi ve vardiya yÃ¶netimini merkezi olarak saÄŸlar.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">ğŸ“Š</div>
                    <h4>Analytics & BI</h4>
                    <p>TÃ¼m verilerinizi iÅŸler, profesyonel raporlar ve dashboardlar sunar.</p>
                </div>
            </div>

            <div class="chk-list">
                <div class="chk-item" id="chk-admin">
                    <span class="icon">âšª</span> YÃ¶netici Yetkisi (Admin)
                </div>
                <div class="chk-item" id="chk-python">
                    <span class="icon">âšª</span> Python SÃ¼rÃ¼mÃ¼ (3.10+)
                </div>
                <div class="chk-item" id="chk-ram">
                    <span class="icon">âšª</span> Sistem KaynaklarÄ±
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-secondary" onclick="goBack(1)">Geri DÃ¶n</button>
                <button class="btn btn-primary" id="btn-start" disabled onclick="goToStep(3)">Sistem KontrolÃ¼nÃ¼ Tamamla
                    ve BaÅŸla</button>
            </div>
        </div>

        <!-- Step 3: Database Configuration -->
        <div class="card" id="card-3">
            <h1>VeritabanÄ± YapÄ±landÄ±rmasÄ±</h1>
            <p class="intro-text">Uygulama verilerinin saklanacaÄŸÄ± PostgreSQL ve ERP entegrasyonu iÃ§in MSSQL bilgilerini
                girin.</p>

            <div class="db-tabs">
                <div class="db-tab active" id="tab-local" onclick="switchDBTab('local')">Yerel Kurulum</div>
                <div class="db-tab" id="tab-migration" onclick="switchDBTab('migration')">Sunucudan TaÅŸÄ±ma</div>
            </div>

            <div id="local-db-area">
                <div class="db-grid">
                    <!-- PostgreSQL -->
                    <div class="db-panel">
                        <div class="db-header">
                            <img src="https://wiki.postgresql.org/images/a/a4/PostgreSQL_logo.3colors.svg" alt="PG">
                            <h3>PostgreSQL (Ana VeritabanÄ±)</h3>
                        </div>
                        <div class="input-group">
                            <label>Host</label>
                            <input type="text" id="pg-host" value="localhost">
                        </div>
                        <div class="input-group">
                            <label>Port</label>
                            <input type="text" id="pg-port" value="5432">
                        </div>
                        <div class="input-group">
                            <label>KullanÄ±cÄ±</label>
                            <input type="text" id="pg-user" value="postgres">
                        </div>
                        <div class="input-group">
                            <label>Åifre</label>
                            <input type="password" id="pg-pass">
                        </div>
                        <div class="input-group">
                            <label>DB AdÄ±</label>
                            <input type="text" id="pg-db" value="EXFINOPS">
                        </div>
                        <div class="input-group checkbox-group">
                            <input type="checkbox" id="load-demo">
                            <label for="load-demo">Ã–rnek Demo Verileri YÃ¼kle</label>
                        </div>
                        <button class="btn btn-secondary" onclick="testDB('postgres')">Test Et</button>
                    </div>

                    <!-- MSSQL / Logo -->
                    <div class="db-panel">
                        <div class="db-header">
                            <img src="https://www.svgrepo.com/show/303229/microsoft-sql-server-logo.svg" alt="SQL">
                            <h3>Logo ERP (Opsiyonel)</h3>
                        </div>
                        <div class="input-group">
                            <label>Host</label>
                            <input type="text" id="ms-host" value=".">
                        </div>
                        <div class="input-group">
                            <label>KullanÄ±cÄ±</label>
                            <input type="text" id="ms-user" value="sa">
                        </div>
                        <div class="input-group">
                            <label>Åifre</label>
                            <input type="password" id="ms-pass">
                        </div>
                        <div class="input-group">
                            <label>DB AdÄ±</label>
                            <input type="text" id="ms-db" value="TIGER3">
                        </div>
                        <button class="btn btn-secondary" onclick="testDB('mssql')">BaÄŸlantÄ±yÄ± Test Et</button>

                        <div id="logo-firm-area" class="hidden">
                            <label
                                style="display:block; margin: 15px 0 5px 0; font-size: 12px; color: var(--text-muted);">AktarÄ±lacak
                                Logo FirmasÄ±nÄ± SeÃ§in</label>
                            <select id="logo-firm-select" class="custom-select">
                                <option value="">Firma SeÃ§in...</option>
                            </select>
                            <div class="input-group checkbox-group" style="margin-top: 15px;">
                                <input type="checkbox" id="sync-logo-check" checked>
                                <label for="sync-logo-check" style="font-size: 11px;">Master Verileri Aktar</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="migration-db-area" class="hidden">
                <div class="db-panel" style="max-width: 100%;">
                    <div class="db-header">
                        <img src="https://avatars.githubusercontent.com/u/54469796?s=280&v=4" alt="Cloud">
                        <h3>Evrensel Veri TaÅŸÄ±ma & Bulut Entegrasyonu</h3>
                    </div>

                    <div class="migration-controls"
                        style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                        <div class="input-group">
                            <label>Kaynak VeritabanÄ± Tipi</label>
                            <select id="remote-db-type" class="custom-select" onchange="toggleMigrationType()">
                                <option value="postgres">PostgreSQL / Supabase (Direkt)</option>
                                <option value="supabase_api">Supabase (API/Token ile Listele)</option>
                                <option value="mssql">MS SQL Server (Uzak)</option>
                                <option value="mysql">MySQL (Uzak)</option>
                            </select>
                        </div>

                        <div id="supabase-api-login" class="hidden">
                            <div class="input-group">
                                <label style="display: flex; justify-content: space-between;">
                                    Supabase Token
                                    <a href="https://supabase.com/dashboard/account/tokens" target="_blank"
                                        style="font-size: 10px; color: var(--primary); text-decoration: none;">Token Al
                                        â†—</a>
                                </label>
                                <div style="display: flex; gap: 10px;">
                                    <input type="password" id="supabase-token" placeholder="sbp_xxxxxxxxxxxx"
                                        style="flex: 1;">
                                    <button class="btn btn-secondary" onclick="fillMigrationDefaults()"
                                        style="padding: 8px 15px; background: rgba(var(--primary-rgb), 0.1); border-color: var(--primary);">VarsayÄ±lan</button>
                                    <button class="btn btn-secondary" onclick="fetchSupabaseProjects()"
                                        style="padding: 8px 15px;">Listele</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div
                        style="background: rgba(255,255,255,0.03); border: 1px solid #333; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div
                            style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <span style="font-size: 12px; font-weight: bold; color: var(--text-muted);">HEDEF VERÄ°TABANI
                                (YEREL)</span>
                            <select id="migration-target" class="custom-select"
                                style="width: auto; padding: 5px 10px; font-size: 11px;">
                                <option value="postgres">Yerel PostgreSQL (Ana)</option>
                                <option value="mssql">Yerel Logo DB (MSSQL)</option>
                            </select>
                        </div>
                        <div id="local-db-info"
                            style="font-family: monospace; font-size: 11px; color: var(--success); opacity: 0.8;">
                            PostgreSQL: BaÄŸlantÄ± hazÄ±r...
                        </div>
                    </div>

                    <div class="db-grid" style="grid-template-columns: 1.5fr 1fr; gap: 20px;">
                        <div>
                            <div id="remote-conn-field">
                                <div class="input-group">
                                    <label id="remote-conn-label">Uzak Sunucu BaÄŸlantÄ± Dizesi</label>
                                    <input type="text" id="remote-conn-str"
                                        placeholder="postgresql://user:pass@host:port/db">
                                </div>
                            </div>

                            <div id="supabase-project-list" class="hidden">
                                <div class="input-group">
                                    <label>Supabase Projesi SeÃ§in</label>
                                    <select id="supabase-project-select" class="custom-select"
                                        onchange="selectSupabaseProject()">
                                        <option value="">Proje SeÃ§in...</option>
                                    </select>
                                </div>
                            </div>

                            <button class="btn btn-secondary" onclick="analyzeRemoteDB()">ÅemayÄ± Analiz Et</button>
                        </div>
                        <div id="migration-log" class="log-output" style="height: 180px; font-size: 11px;">
                            Kaynak sunucu analizi bekleniyor...
                        </div>
                    </div>
                    <div id="remote-tables-view" class="data-selection-list hidden">
                        <!-- Remote tables will load here -->
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-secondary" onclick="goBack(2)">Geri DÃ¶n</button>
                <div id="db-status"></div>
                <button class="btn btn-primary" id="btn-next-db" disabled onclick="handleDBFinish()">VeritabanÄ±nÄ± Kur ve
                    Devam Et</button>
            </div>
        </div>

        <!-- Step 4: Logo Data Selection -->
        <div class="card" id="card-4">
            <div class="step-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <img src="https://www.svgrepo.com/show/303229/microsoft-sql-server-logo.svg" alt="Logo"
                    style="width: 48px; filter: drop-shadow(0 0 10px var(--primary));">
                <div>
                    <h1 style="margin: 0;">Logo Veri AktarÄ±mÄ±</h1>
                    <p class="intro-text" style="margin: 0;">BaÄŸlanÄ±lan firmadan aktarÄ±lacak detaylÄ± verileri seÃ§in.</p>
                </div>
            </div>

            <div id="logo-selection-container"
                style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;">
                <div class="selection-panel">
                    <div class="selection-header">ğŸ‘¤ SatÄ±ÅŸ ElemanlarÄ±</div>
                    <div class="data-selection-list" id="list-salesmen">
                        <div class="selection-item">Veriler bekleniyor...</div>
                    </div>
                </div>

                <div class="selection-panel">
                    <div class="selection-header">ğŸ  Ambarlar / Depolar</div>
                    <div class="data-selection-list" id="list-warehouses">
                        <div class="selection-item">Veriler bekleniyor...</div>
                    </div>
                </div>
            </div>

            <div class="card-footer" style="margin-top: 30px;">
                <button class="btn btn-secondary" onclick="goBack(3)">Geri DÃ¶n</button>
                <button class="btn btn-primary" onclick="goToStep(5)">SeÃ§ili Verileri Senkronize Et ve Kuruluma
                    BaÅŸla</button>
            </div>
        </div>

        <!-- Step 5: Installation Progress -->
        <div class="card" id="card-5">
            <h2>Kurulum TamamlanÄ±yor</h2>

            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>

            <div class="log-output" id="install-logs">
                > Kurulum baÅŸlatÄ±lÄ±yor...
            </div>

            <div class="success-screen hidden" id="success-screen">
                <div class="checkmark">
                    <img src="modern_database_icon_v2.png" alt="Check"
                        style="width: 80px; filter: drop-shadow(0 0 10px var(--primary));">
                </div>
                <h3 style="margin-top: 20px;">Kurulum BaÅŸarÄ±lÄ±!</h3>
                <p>EXFIN <span id="success-app-name"></span> Servisi arka planda Ã§alÄ±ÅŸÄ±yor.</p>
                <div class="dashboard-link">
                    <button class="btn btn-primary" onclick="launchTray()">Tepsiyi (Tray) BaÅŸlat</button>
                    <a href="http://localhost:8000/docs" target="_blank" class="btn btn-secondary">Swagger API AÃ§</a>
                </div>
            </div>
        </div>

    </div>

    <script src="app.js"></script>
</body>

</html>