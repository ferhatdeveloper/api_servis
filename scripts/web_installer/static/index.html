<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EXFIN OPS Setup</title>
    <link rel="stylesheet" href="style.css?v=1.0.5">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

    <div class="background-globes">
        <div class="globe g1"></div>
        <div class="globe g2"></div>
    </div>

    <div class="installer-container" id="app">

        <!-- Header -->
        <header>
            <div class="logo">EXFIN <span>API KURULUM SÄ°STEMÄ°</span></div>
            <div class="step-indicator">
                <div class="step active" id="s1">1</div>
                <div class="line"></div>
                <div class="step" id="s2">2</div>
                <div class="line"></div>
                <div class="step" id="s3">3</div>
                <div class="line"></div>
                <div class="step" id="s4">4</div>
                <div class="line"></div>
                <div class="step" id="s5">5</div>
            </div>
        </header>

        <!-- Step 1: App Selection -->
        <div class="card active" id="card-1">
            <h1>Uygulama SeÃ§imi</h1>
            <p class="intro-text">Kurmak istediÄŸiniz EXFIN Ã§Ã¶zÃ¼mÃ¼nÃ¼ seÃ§in. Her Ã§Ã¶zÃ¼m kendi veritabanÄ± yapÄ±sÄ± ve API
                yapÄ±landÄ±rmasÄ± ile gelir.</p>

            <div class="app-selector">
                <div class="app-card" onclick="selectApp('OPS', this)">
                    <div class="app-icon">âš™ï¸</div>
                    <div class="app-info">
                        <h3>EXFIN OPS</h3>
                        <p>Genel Operasyon YÃ¶netimi</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('RETAIL', this)">
                    <div class="app-icon">ğŸ›’</div>
                    <div class="app-info">
                        <h3>EXFIN RETAIL</h3>
                        <p>Perakende & MaÄŸazacÄ±lÄ±k</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('HRM', this)">
                    <div class="app-icon">ğŸ‘¥</div>
                    <div class="app-info">
                        <h3>EXFIN HRM - PDKS</h3>
                        <p>Ä°nsan KaynaklarÄ± & Personel</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('CAFE', this)">
                    <div class="app-icon">ğŸ½ï¸</div>
                    <div class="app-info">
                        <h3>EXFIN CAFE</h3>
                        <p>Restaurant & Cafe YÃ¶netimi</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('BEATPY', this)">
                    <div class="app-icon">ğŸ</div>
                    <div class="app-info">
                        <h3>EXFIN BEATPY</h3>
                        <p>Python Destekli Analiz & BI</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('EXCHANGE', this)">
                    <div class="app-icon">ğŸ’±</div>
                    <div class="app-info">
                        <h3>EXFIN EXCHANGE</h3>
                        <p>DÃ¶viz BÃ¼rolarÄ± (TR & IQ Market)</p>
                    </div>
                </div>
                <div class="app-card" onclick="selectApp('BRIDGE', this)">
                    <div class="app-icon">ğŸŒ‰</div>
                    <div class="app-info">
                        <h3>EXFIN BRIDGE</h3>
                        <p>Entegrasyon & Veri KÃ¶prÃ¼sÃ¼</p>
                    </div>
                </div>
            </div>

            <div class="card-footer">
                <div></div> <!-- Empty for alignment -->
                <button class="btn btn-primary" id="btn-next-1" disabled onclick="goToStep(2)">UygulamayÄ± SeÃ§ ve Devam
                    Et</button>
            </div>
        </div>

        <!-- Step 2: Welcome & Checks -->
        <div class="card" id="card-2">
            <h1>Sistem KontrolÃ¼</h1>
            <p class="intro-text">EXFIN Kurumsal Operasyon YÃ¶netim Sistemi kurulumuna hoÅŸ geldiniz. Bu sihirbaz,
                iÅŸletmenizin tÃ¼m dijital sÃ¼reÃ§lerini tek bir platformda toplamanÄ±za yardÄ±mcÄ± olur.</p>

            <div class="module-cards">
                <div class="mod-card">
                    <div class="mod-icon">ğŸ˜</div>
                    <h4>Logo Entegrasyonu</h4>
                    <p>Tiger/Go3 ERP verilerinizi anlÄ±k olarak EXFIN'e aktarÄ±r, Ã§ift yÃ¶nlÃ¼ konuÅŸur.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">ğŸ›’</div>
                    <h4>Retail & MaÄŸazacÄ±lÄ±k</h4>
                    <p>MaÄŸaza satÄ±ÅŸlarÄ±nÄ±, ambar durumlarÄ±nÄ± ve perakende operasyonlarÄ±nÄ±zÄ± yÃ¶netir.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">â±ï¸</div>
                    <h4>PDKS YÃ¶netimi</h4>
                    <p>Personel giriÅŸ-Ã§Ä±kÄ±ÅŸ takibi ve vardiya yÃ¶netimini merkezi olarak saÄŸlar.</p>
                </div>
                <div class="mod-card">
                    <div class="mod-icon">ğŸ“Š</div>
                    <h4>Analytics & BI</h4>
                    <p>TÃ¼m verilerinizi iÅŸler, profesyonel raporlar ve dashboardlar sunar.</p>
                </div>
            </div>

            <div class="chk-list">
                <div class="chk-item" id="chk-admin">
                    <span class="icon">âšª</span> YÃ¶netici Yetkisi (Admin)
                    <button class="btn-refresh" onclick="runPrerequisiteChecks()" title="Yeniden Kontrol Et"
                        style="margin-left: 10px; background: transparent; border: none; cursor: pointer; color: var(--primary); font-size: 14px;">ğŸ”„</button>
                </div>
                <div class="chk-item" id="chk-python">
                    <span class="icon">âšª</span> Python SÃ¼rÃ¼mÃ¼ (3.10+)
                </div>
                <div class="chk-item" id="chk-ram">
                    <span class="icon">âšª</span> Sistem KaynaklarÄ±
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-secondary" onclick="goBack(1)">Geri DÃ¶n</button>
                <button class="btn btn-primary" id="btn-start" disabled onclick="goToStep(3)">Sistem KontrolÃ¼nÃ¼ Tamamla
                    ve BaÅŸla</button>
            </div>
        </div>

        <!-- Step 3: Database Configuration -->
        <div class="card" id="card-3">
            <h1>VeritabanÄ± YapÄ±landÄ±rmasÄ±</h1>
            <p class="intro-text">Uygulama verilerinin saklanacaÄŸÄ± PostgreSQL ve ERP entegrasyonu iÃ§in MSSQL bilgilerini
                girin.</p>

            <div class="db-tabs">
                <div class="db-tab active" id="tab-local" onclick="switchDBTab('local')">Yerel Kurulum</div>
                <div class="db-tab" id="tab-backup" onclick="switchDBTab('backup')">Otomatik Yedekleme</div>
                <div class="db-tab" id="tab-migration" onclick="switchDBTab('migration')">Sunucudan TaÅŸÄ±ma</div>
            </div>

            <div id="local-db-area">
                <div class="db-grid">
                    <!-- PostgreSQL -->
                    <div class="db-panel">
                        <div class="db-header">
                            <img src="https://wiki.postgresql.org/images/a/a4/PostgreSQL_logo.3colors.svg" alt="PG">
                            <h3 id="pg-header-title">PostgreSQL (Ana VeritabanÄ±)</h3>
                        </div>
                        <div class="input-group">
                            <label>Host</label>
                            <input type="text" id="pg-host" value="localhost">
                        </div>
                        <div class="input-group">
                            <label>Port</label>
                            <input type="text" id="pg-port" value="5432">
                        </div>
                        <div class="input-group">
                            <label>KullanÄ±cÄ±</label>
                            <input type="text" id="pg-user" value="postgres">
                        </div>
                        <div class="input-group">
                            <label>Åifre</label>
                            <div class="password-wrapper">
                                <input type="password" id="pg-pass">
                                <span class="toggle-password" onclick="togglePassword('pg-pass')">ğŸ‘ï¸</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>DB AdÄ±</label>
                            <input type="text" id="pg-db" value="EXFINOPS">
                        </div>
                        <div class="input-group checkbox-group" id="pg-demo-group">
                            <input type="checkbox" id="load-demo">
                            <label for="load-demo" style="display: inline; margin: 0; cursor: pointer;">Ã–rnek Demo
                                Verileri YÃ¼kle</label>
                        </div>

                        <button class="btn btn-secondary" onclick="testDB('postgres')"
                            style="margin-top: 15px; width: 100%;">Test Et</button>
                    </div>

                    <!-- MSSQL / Logo -->
                    <div class="db-panel">
                        <div class="db-header">
                            <img src="https://www.svgrepo.com/show/303229/microsoft-sql-server-logo.svg" alt="SQL">
                            <h3 id="ms-header-title">Logo ERP (Opsiyonel)</h3>
                        </div>
                        <div class="input-group">
                            <label>BaÄŸlantÄ± YÃ¶ntemi</label>
                            <select id="ms-method" class="custom-select" onchange="toggleLogoCredentials()">
                                <option value="direct">Direct Database (SQL)</option>
                                <option value="object">Logo Object (DLL/COM)</option>
                            </select>
                        </div>

                        <!-- Logo Object Credentials -->
                        <div id="logo-object-credentials" class="hidden"
                            style="margin-bottom: 15px; padding: 10px; background: rgba(255,165,0,0.1); border-radius: 8px; border: 1px dashed orange;">
                            <div class="input-group">
                                <label style="color: orange;">Logo Uygulama KullanÄ±cÄ±sÄ±</label>
                                <input type="text" id="ms-logo-user" placeholder="Ã–rn: LOGO_ADMIN">
                            </div>
                            <div class="input-group">
                                <label style="color: orange;">Logo Uygulama Åifresi</label>
                                <div class="password-wrapper">
                                    <input type="password" id="ms-logo-pass">
                                    <span class="toggle-password" onclick="togglePassword('ms-logo-pass')">ğŸ‘ï¸</span>
                                </div>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>Host</label>
                            <input type="text" id="ms-host" value=".">
                        </div>
                        <div class="input-group">
                            <label>Port</label>
                            <input type="text" id="ms-port" value="1433">
                        </div>
                        <div class="input-group">
                            <label>KullanÄ±cÄ±</label>
                            <input type="text" id="ms-user" value="sa">
                        </div>
                        <div class="input-group">
                            <label>Åifre</label>
                            <div class="password-wrapper">
                                <input type="password" id="ms-pass">
                                <span class="toggle-password" onclick="togglePassword('ms-pass')">ğŸ‘ï¸</span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label>DB AdÄ±</label>
                            <input type="text" id="ms-db" value="TIGER3">
                        </div>
                        <button class="btn btn-secondary" onclick="testDB('mssql')" style="width: 100%;">BaÄŸlantÄ±yÄ± Test
                            Et</button>

                        <div id="logo-firm-area" class="hidden">
                            <label
                                style="display:block; margin: 15px 0 10px 0; font-size: 13px; color: var(--text-muted); font-weight: 500;">AktarÄ±lacak
                                Logo FirmasÄ±nÄ± SeÃ§in</label>
                            <div id="logo-firm-cards" class="firm-selector"></div>
                            <input type="hidden" id="logo-firm-select" />
                        </div>
                    </div>
                </div>

            </div>

            <!-- Backup Configuration View -->
            <div id="backup-db-area" class="hidden">
                <div class="db-panel" style="max-width: 600px; margin: 0 auto;">
                    <div class="db-header">
                        <span style="font-size: 24px;">ğŸ”„</span>
                        <h3>Otomatik Yedekleme YapÄ±landÄ±rmasÄ±</h3>
                    </div>

                    <p style="font-size: 13px; margin-bottom: 20px;">
                        VeritabanÄ±nÄ±zÄ±n gÃ¼venliÄŸi iÃ§in periyodik yedeklemeler ayarlayÄ±n.
                        Yedekler belirtilen dizinde <code>.sql</code> formatÄ±nda saklanacaktÄ±r.
                    </p>

                    <div class="input-group">
                        <label>Yedekleme Dizini</label>
                        <input type="text" id="backup-dir" value="C:\EXFIN_Backups">
                    </div>

                    <div class="db-grid" style="margin-bottom: 0;">
                        <div class="input-group">
                            <label>SÄ±klÄ±k</label>
                            <select id="backup-interval" class="custom-select" onchange="toggleBackupOptions()">
                                <option value="off">KapalÄ±</option>
                                <option value="hourly">Saatlik</option>
                                <option value="daily" selected>GÃ¼nlÃ¼k</option>
                                <option value="weekly">HaftalÄ±k</option>
                            </select>
                        </div>
                        <div class="input-group" id="backup-time-group">
                            <label>Saat</label>
                            <input type="text" id="backup-time" value="23:00">
                        </div>
                    </div>

                    <div id="backup-hour-group" class="hidden">
                        <div class="input-group">
                            <label>Her kaÃ§ saatte bir?</label>
                            <input type="number" id="backup-hours" value="1" min="1" max="23">
                        </div>
                    </div>

                    <div id="backup-days-group" class="hidden">
                        <label
                            style="display: block; font-size: 13px; color: var(--text-muted); margin-bottom: 8px;">GÃ¼nler</label>
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;">
                            <label><input type="checkbox" value="mon" checked> Pzt</label>
                            <label><input type="checkbox" value="tue" checked> Sal</label>
                            <label><input type="checkbox" value="wed" checked> Ã‡ar</label>
                            <label><input type="checkbox" value="thu" checked> Per</label>
                            <label><input type="checkbox" value="fri" checked> Cum</label>
                            <label><input type="checkbox" value="sat" checked> Cmt</label>
                            <label><input type="checkbox" value="sun" checked> Paz</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Migration View (Simplified for now to match v0 but kept feature-rich) -->
            <div id="migration-db-area" class="hidden">
                <div class="db-panel" style="max-width: 100%;">
                    <!-- (Kept most of the migration UI from previous index.html for completeness) -->
                    <div class="db-header">
                        <img src="https://avatars.githubusercontent.com/u/54469796?s=280&v=4" alt="Cloud">
                        <h3>Evrensel Veri TaÅŸÄ±ma & Bulut Entegrasyonu</h3>
                    </div>
                    <!-- Simplified migration controls for restricted height -->
                    <div class="input-group">
                        <label>Kaynak VeritabanÄ± Tipi</label>
                        <select id="remote-db-type" class="custom-select" onchange="toggleMigrationType()">
                            <option value="postgres">PostgreSQL / Supabase (Direkt)</option>
                            <option value="supabase_api">Supabase (API/Token)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>BaÄŸlantÄ± Dizesi</label>
                        <input type="text" id="remote-conn-str" placeholder="postgresql://user:pass@host:port/db">
                    </div>
                    <button class="btn btn-secondary" onclick="analyzeRemoteDB()">Analiz Et</button>
                    <div id="migration-log" class="log-output" style="height: 120px; margin-top:15px;">Kaynak analizi
                        bekleniyor...</div>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-secondary" onclick="goBack(2)">Geri DÃ¶n</button>
                <div id="db-status"></div>
                <button class="btn btn-primary" id="btn-next-db" disabled onclick="handleDBFinish()">VeritabanÄ±nÄ± Kur ve
                    Devam Et</button>
            </div>
        </div>

        <!-- Step 4: Logo Data Selection -->
        <div class="card" id="card-4">
            <div class="step-header" style="margin-bottom: 20px;">
                <h1>Logo Veri AktarÄ±mÄ±</h1>
                <p class="intro-text">BaÄŸlanÄ±lan firmadan aktarÄ±lacak detaylÄ± verileri seÃ§in.</p>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-nav">
                <button class="tab-btn active" onclick="switchDataTab('tab-salesmen', this)">ğŸ‘¤ SatÄ±ÅŸÃ§Ä±lar</button>
                <button class="tab-btn" onclick="switchDataTab('tab-warehouses', this)">ğŸ  Ambarlar</button>
                <button class="tab-btn" onclick="switchDataTab('tab-customers', this)">ğŸ¤ MÃ¼ÅŸteriler</button>
            </div>

            <!-- Tab 1: Salesmen -->
            <div id="tab-salesmen" class="tab-pane active">
                <div class="selection-header">
                    <div class="header-left">
                        <span>SatÄ±ÅŸ ElemanlarÄ±</span>
                        <div class="search-box">
                            <input type="text" placeholder="SatÄ±ÅŸÃ§Ä± ara..."
                                onkeyup="filterTable('list-salesmen', this.value)">
                            <span class="search-icon">ğŸ”</span>
                        </div>
                    </div>
                    <button class="btn-preview" onclick="openPreview('salesmen')">Ã–nizle</button>
                </div>
                <div class="data-selection-list">
                    <table class="selection-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="sel-all-salesmen"
                                        onchange="selectAll('salesmen', this.checked)" checked></th>
                                <th style="width: 60px;">Ref</th>
                                <th style="width: 80px;">Kod</th>
                                <th>Ä°sim / AÃ§Ä±klama</th>
                                <th>KullanÄ±cÄ± AdÄ±</th>
                                <th style="width: 150px;">Åifre</th>
                            </tr>
                        </thead>
                        <tbody id="list-salesmen"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 2: Warehouses -->
            <div id="tab-warehouses" class="tab-pane hidden">
                <div class="selection-header">
                    <div class="header-left">
                        <span>Ambarlar / Depolar</span>
                        <div class="search-box">
                            <input type="text" placeholder="Ambar ara..."
                                onkeyup="filterTable('list-warehouses', this.value)">
                            <span class="search-icon">ğŸ”</span>
                        </div>
                    </div>
                    <button class="btn-preview" onclick="openPreview('warehouses')">Ã–nizle</button>
                </div>
                <div class="data-selection-list">
                    <table class="selection-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="sel-all-warehouses"
                                        onchange="selectAll('warehouses', this.checked)" checked></th>
                                <th style="width: 80px;">No</th>
                                <th>Ambar AdÄ±</th>
                            </tr>
                        </thead>
                        <tbody id="list-warehouses"></tbody>
                    </table>
                </div>
            </div>

            <!-- Tab 3: Customers -->
            <div id="tab-customers" class="tab-pane hidden">
                <div class="selection-header">
                    <div class="header-left">
                        <span>MÃ¼ÅŸteriler (Cari Hesaplar)</span>
                        <div class="search-box">
                            <input type="text" placeholder="MÃ¼ÅŸteri ara..."
                                onkeyup="filterTable('list-customers', this.value)">
                            <span class="search-icon">ğŸ”</span>
                        </div>
                    </div>
                    <button class="btn-preview" onclick="openPreview('customers')">Ã–nizle</button>
                </div>
                <div class="data-selection-list">
                    <table class="selection-table">
                        <thead>
                            <tr>
                                <th style="width: 40px;"><input type="checkbox" id="sel-all-customers"
                                        onchange="selectAll('customers', this.checked)" checked></th>
                                <th style="width: 120px;">Cari Kod</th>
                                <th>Ãœnvan / Ä°sim</th>
                                <th style="width: 100px;">Ã–zel Kod</th>
                                <th style="width: 100px;">Grup Kodu</th>
                                <th style="width: 150px;">Harita BaÄŸlantÄ±sÄ±</th>
                            </tr>
                        </thead>
                        <tbody id="list-customers"></tbody>
                    </table>
                </div>
            </div>

            <div class="card-footer">
                <button class="btn btn-secondary" onclick="goBack(3)">Geri DÃ¶n</button>
                <button class="btn btn-primary" onclick="goToStep(5)">Senkronize Et ve Devam Et</button>
            </div>
        </div>

        <!-- Step 5: Progress -->
        <div class="card" id="card-5">
            <h2>Kurulum TamamlanÄ±yor</h2>
            <div class="progress-container">
                <div class="progress-bar"></div>
            </div>
            <div class="log-output" id="install-logs">> Kurulum baÅŸlatÄ±lÄ±yor...</div>

            <div class="success-screen hidden" id="success-screen">
                <div class="checkmark">âœ…</div>
                <h3>Kurulum BaÅŸarÄ±lÄ±!</h3>
                <p>EXFIN <span id="success-app-name"></span> Servisi arka planda Ã§alÄ±ÅŸÄ±yor.</p>
                <p id="success-port-info" class="text-success" style="font-weight: 600; margin-top: 5px;"></p>


                <div class="dashboard-link" style="margin-top:20px; display: flex; gap:10px; justify-content: center;">
                    <button class="btn btn-primary" onclick="launchTray()">Tepsiyi BaÅŸlat</button>
                    <a href="http://localhost:8000/docs" target="_blank" class="btn btn-secondary">API Docs</a>
                </div>
            </div>
        </div>

        <!-- Modal -->
        <div id="preview-modal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header" style="display: flex; justify-content: space-between; margin-bottom: 20px;">
                    <h2 id="modal-title">Ã–nizleme</h2>
                    <span class="close-btn" onclick="closeModal()" style="cursor:pointer; font-size:24px;">Ã—</span>
                </div>
                <div class="modal-body" id="modal-body" style="flex:1; overflow-y:auto;"></div>
                <div class="modal-footer" style="margin-top:20px; text-align:right;">
                    <button class="btn btn-secondary" onclick="closeModal()">Kapat</button>
                </div>
            </div>
        </div>

    </div>

    <script src="app.js?v=1.0.5"></script>
</body>

</html>